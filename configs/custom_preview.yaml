name: custom_preview
description: Fast high-quality preview preset (good for quick PSNR checks)
expected_time: 10–20 minutes (scene & GPU dependent)

# ─────────────────────────────────────────────────────────────
# HLOC / SfM configuration (maps directly to run_hloc.py flags)
# ─────────────────────────────────────────────────────────────
sfm:
  # Pair generation & retrieval
  matching_method: retrieval            # --matching-method {retrieval,sequential,exhaustive}
  seq_overlap: 8                        # --seq-overlap (only used if sequential)
  seq_quadratic_overlap: false          # --seq-quadratic-overlap
  seq_loop_closure: true                # --seq-loop-closure (helps a bit for looped paths)
  num_matched: 18                       # --num_matched (slightly lower than balanced=20 to save time)

  # Global / local features
  global_extractor: netvlad             # --global_extractor
  extractor: disk                       # --extractor
  matcher: disk-lightglue               # --matcher

  # SuperGlue fields are here for completeness if you switch matcher later
  superglue_weights: outdoor            # --superglue_weights
  sinkhorn_iterations: 50               # --sinkhorn_iterations

  # Camera & backend
  camera_model: PINHOLE                 # --camera_model
  sfm_backend: glomap                   # --sfm-backend
  glomap_bin: glomap                    # --glomap-bin

  # Misc HLOC options
  vis: false                            # --vis
  keep_intermediates: false             # --keep_intermediates (cleaner / faster)

  # Downsample factor for images used by GSplat
  data_factor: 8                        # higher factor => lower res => faster GSplat

# ─────────────────────────────────────────────────────────────
# GSplat configuration (maps to simple_trainer.py mcmc flags)
# ─────────────────────────────────────────────────────────────
gsplat:
  # which subcommand of simple_trainer.py to use
  subcommand: mcmc                      # "mcmc" or "default"

  # core training / IO
  data_factor: 8                        # --data-factor (keep aligned with sfm.data_factor)
  max_steps: 15000                      # --max-steps (shorter than balanced=30000)
  eval_steps: [5000, 15000]             # --eval-steps 5000 --eval-steps 15000
  save_ply: true                        # --save-ply
  save_steps: [15000]                   # --save-steps
  ply_steps: [15000]                    # --ply-steps

  # rendering / viewer behaviour
  disable_viewer: true                  # --disable-viewer (use CLI only; faster/no web viewer)
  disable_video: true                   # --disable-video
  port: 8080                            # --port

  # camera & scene scale
  camera_model: pinhole                 # --camera-model
  global_scale: 1.0                     # --global-scale
  normalize_world_space: true           # --normalize-world-space

  # optimisation / quality
  batch_size: 1                         # --batch-size (keeps VRAM low; stable)
  steps_scaler: 1.0                     # --steps-scaler
  ssim_lambda: 0.2                      # --ssim-lambda
  antialiased: true                     # --antialiased
  random_bkgd: true                     # --random-bkgd (helps avoid floaty transparent bits)

  # SH / appearance
  sh_degree: 2                          # --sh-degree (slightly lower than full 3 → faster)
  sh_degree_interval: 1000              # --sh-degree-interval
  init_type: sfm                        # --init-type
  init_opa: 0.5                         # --init-opa
  init_scale: 0.1                       # --init-scale

  # learning rates
  means_lr: 0.00016                     # --means-lr
  scales_lr: 0.005                      # --scales-lr
  opacities_lr: 0.05                    # --opacities-lr
  quats_lr: 0.001                       # --quats-lr
  sh0_lr: 0.0025                        # --sh0-lr
  shN_lr: 0.000125                      # --shN-lr

  # regularisation
  opacity_reg: 0.01                     # --opacity-reg
  scale_reg: 0.01                       # --scale-reg

  # pose optimisation (off here for speed; turn on via override if needed)
  pose_opt: false                       # --pose-opt / --no-pose-opt
  pose_opt_lr: 1.0e-5                   # --pose-opt-lr
  pose_opt_reg: 1.0e-6                  # --pose-opt-reg
  pose_noise: 0.0                       # --pose-noise

  # depth supervision (kept off for preview)
  depth_loss: false                     # --depth-loss
  depth_lambda: 0.01                    # --depth-lambda

  # logging
  tb_every: 300                         # --tb-every
  tb_save_image: false                  # --tb-save-image
  lpips_net: alex                       # --lpips-net

  # memory / performance tweaks
  packed: true                          # --packed
  sparse_grad: false                    # --sparse-grad
  visible_adam: false                   # --visible-adam

  # MCMC densification strategy
  strategy:
    cap_max: 800000                     # --strategy.cap-max (lower cap => fewer splats, faster)
    noise_lr: 500000.0                  # --strategy.noise-lr
    min_opacity: 0.005                  # --strategy.min-opacity
    refine_start_iter: 500              # --strategy.refine-start-iter
    refine_stop_iter: 12000             # --strategy.refine-stop-iter (stop earlier)
    refine_every: 100                   # --strategy.refine-every
    verbose: true                       # --strategy.verbose
